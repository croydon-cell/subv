(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[770],{96335:function(e,s,t){Promise.resolve().then(t.bind(t,84461))},84461:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return L}});var l=t(57437),a=t(2265),i=t(94411),r=t(61264),n=t(10273),c=t(56360),d=t(79004),o=t(77700);let x=a.forwardRef((e,s)=>{let{className:t,type:a,...i}=e;return(0,l.jsx)("input",{type:a,className:(0,o.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...i})});x.displayName="Input";var m=t(25797),h=t(66706),u=t(11240),j=t(51077),p=t(40933),g=t(78030);let v=(0,g.Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),f=(0,g.Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),b=(0,g.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var y=t(55430);let N=(0,g.Z)("pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var w=t(98094),k=t(92940),_=t(35231),Z=t(25974),C=t(54142),S=t(2842),z=t(9542),R=t(85475),D=t(45745);function L(){var e,s,t,o,g,L,O,A,M,E,P;let[T,Y]=(0,a.useState)([]),[I,q]=(0,a.useState)(null),[F,H]=(0,a.useState)(null),[K,W]=(0,a.useState)(!0),[B,J]=(0,a.useState)(""),[Q,$]=(0,a.useState)("all");(0,a.useEffect)(()=>{G()},[]);let G=async()=>{W(!0);try{let[e,s,t]=await Promise.all([fetch("/api/operator/subscribers"),fetch("/api/operator/collections"),fetch("/api/operator/settlements")]),[l,a,i]=await Promise.all([e.json(),s.json(),t.json()]);Y(l.data),q(a.data),H(i.data)}catch(e){console.error("Error fetching dashboard data:",e)}finally{W(!1)}},U=async(e,s)=>{try{let t=await fetch("/api/operator/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriber_id:s.id,subscriber_name:s.name})}),l=await t.json();alert(l.message),G()}catch(e){console.error("Error performing action:",e)}},V=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),X=T.filter(e=>{let s=e.name.toLowerCase().includes(B.toLowerCase())||e.id.toLowerCase().includes(B.toLowerCase()),t="all"===Q||e.status===Q;return s&&t}),ee={active:T.filter(e=>"active"===e.status).length,expired:T.filter(e=>"expired"===e.status).length,high_risk:T.filter(e=>"high"===e.risk_level).length};return K?(0,l.jsx)(i.c,{currentRole:"operator",children:(0,l.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(h.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),(0,l.jsx)("p",{className:"text-slate-600",children:"Loading dashboard..."})]})})}):(0,l.jsx)(i.c,{currentRole:"operator",children:(0,l.jsxs)("div",{className:"p-8 space-y-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"Operator Dashboard"}),(0,l.jsx)("p",{className:"text-slate-600 mt-2",children:"Subscriber management & collections tracking"})]}),(0,l.jsxs)(c.z,{onClick:G,className:"bg-gradient-to-r from-blue-600 to-indigo-600",children:[(0,l.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,l.jsx)(r.A,{title:"Active Subscribers",value:ee.active,icon:u.Z,gradient:!0}),(0,l.jsx)(r.A,{title:"Today's Collections",value:V((null==I?void 0:null===(e=I.today)||void 0===e?void 0:e.collected)||0),icon:j.Z,subtitle:"".concat((null==I?void 0:null===(s=I.today)||void 0===s?void 0:s.collection_rate)||0,"% rate")}),(0,l.jsx)(r.A,{title:"Pending Collections",value:V((null==I?void 0:null===(t=I.today)||void 0===t?void 0:t.pending)||0),icon:p.Z,subtitle:"Target: ".concat(V((null==I?void 0:null===(o=I.today)||void 0===o?void 0:o.target)||0))}),(0,l.jsx)(r.A,{title:"High Risk Subscribers",value:ee.high_risk,icon:v,subtitle:"Requires attention"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsxs)(n.Zb,{className:"border-0 shadow-lg",children:[(0,l.jsxs)(n.Ol,{children:[(0,l.jsx)(n.ll,{children:"Subscriber Management"}),(0,l.jsx)(n.SZ,{children:"Quick actions and status tracking"}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[(0,l.jsxs)("div",{className:"relative flex-1",children:[(0,l.jsx)(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),(0,l.jsx)(x,{placeholder:"Search by name or ID...",value:B,onChange:e=>J(e.target.value),className:"pl-9"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(c.z,{variant:"all"===Q?"default":"outline",size:"sm",onClick:()=>$("all"),children:"All"}),(0,l.jsx)(c.z,{variant:"active"===Q?"default":"outline",size:"sm",onClick:()=>$("active"),children:"Active"}),(0,l.jsx)(c.z,{variant:"expired"===Q?"default":"outline",size:"sm",onClick:()=>$("expired"),children:"Expired"})]})]})]}),(0,l.jsx)(n.aY,{children:(0,l.jsx)(m.x,{className:"h-[600px]",children:(0,l.jsx)("div",{className:"space-y-4",children:X.map(e=>(0,l.jsx)(n.Zb,{className:"border-l-4",style:{borderLeftColor:"expired"===e.status?"#ef4444":"high"===e.risk_level?"#f59e0b":"#10b981"},children:(0,l.jsxs)(n.aY,{className:"pt-6",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("h4",{className:"font-semibold text-lg",children:e.name}),(0,l.jsx)(d.C,{variant:"active"===e.status?"success":"destructive",children:e.status}),"high"===e.risk_level&&(0,l.jsx)(d.C,{variant:"warning",children:"High Risk"})]}),(0,l.jsx)("p",{className:"text-sm text-slate-600",children:e.id}),(0,l.jsxs)("p",{className:"text-sm text-slate-600",children:[e.phone," â€¢ ",e.email]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"font-semibold",children:e.plan}),(0,l.jsxs)("p",{className:"text-sm text-slate-600",children:["Expires: ",new Date(e.expiry_date).toLocaleDateString()]}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:e.days_until_expiry>0?"".concat(e.days_until_expiry," days left"):"".concat(Math.abs(e.days_until_expiry)," days overdue")})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-slate-600",children:"Last Payment"}),(0,l.jsx)("p",{className:"font-medium",children:new Date(e.last_payment).toLocaleDateString()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-slate-600",children:"Payment Method"}),(0,l.jsx)("p",{className:"font-medium",children:e.payment_method})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>U("send-reminder",e),children:[(0,l.jsx)(b,{className:"h-3 w-3 mr-1"}),"Send Reminder"]}),(0,l.jsxs)(c.z,{size:"sm",variant:"outline",onClick:()=>U("trigger-retry",e),children:[(0,l.jsx)(y.Z,{className:"h-3 w-3 mr-1"}),"Trigger Retry"]}),(0,l.jsx)(c.z,{size:"sm",variant:"outline",onClick:()=>U("pause-service",e),children:"active"===e.status?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N,{className:"h-3 w-3 mr-1"})," Pause"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w.Z,{className:"h-3 w-3 mr-1"})," Resume"]})})]})]})},e.id))})})})]})}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(n.Zb,{className:"border-0 shadow-lg",children:[(0,l.jsx)(n.Ol,{children:(0,l.jsx)(n.ll,{children:"Collections Overview"})}),(0,l.jsxs)(n.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"p-4 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200",children:[(0,l.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"Today"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-green-600",children:V((null==I?void 0:null===(g=I.today)||void 0===g?void 0:g.collected)||0)}),(0,l.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:[(null==I?void 0:null===(L=I.today)||void 0===L?void 0:L.collection_rate)||0,"% of target"]})]}),(0,l.jsxs)("div",{className:"p-4 rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200",children:[(0,l.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"This Week"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:V((null==I?void 0:null===(O=I.week)||void 0===O?void 0:O.collected)||0)}),(0,l.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:[(null==I?void 0:null===(A=I.week)||void 0===A?void 0:A.collection_rate)||0,"% of target"]})]}),(0,l.jsxs)("div",{className:"p-4 rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200",children:[(0,l.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"This Month"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-purple-600",children:V((null==I?void 0:null===(M=I.month)||void 0===M?void 0:M.collected)||0)}),(0,l.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:[(null==I?void 0:null===(E=I.month)||void 0===E?void 0:E.collection_rate)||0,"% of target"]})]})]})]}),(0,l.jsxs)(n.Zb,{className:"border-0 shadow-lg",children:[(0,l.jsx)(n.Ol,{children:(0,l.jsx)(n.ll,{children:"Weekly Trend"})}),(0,l.jsx)(n.aY,{children:(0,l.jsx)(_.h,{width:"100%",height:200,children:(0,l.jsxs)(Z.v,{data:(null==I?void 0:I.daily_breakdown)||[],children:[(0,l.jsx)(C.q,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,l.jsx)(S.K,{dataKey:"day"}),(0,l.jsx)(z.B,{}),(0,l.jsx)(R.u,{formatter:e=>V(e)}),(0,l.jsx)(D.$,{dataKey:"collected",fill:"#3b82f6",radius:[8,8,0,0]})]})})})]}),(0,l.jsxs)(n.Zb,{className:"border-0 shadow-lg",children:[(0,l.jsx)(n.Ol,{children:(0,l.jsx)(n.ll,{children:"Settlement Report"})}),(0,l.jsxs)(n.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"p-4 rounded-lg bg-slate-50 border border-slate-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-sm text-slate-600",children:"Pending Settlement"}),(0,l.jsx)(p.Z,{className:"h-4 w-4 text-orange-500"})]}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:V((null==F?void 0:F.pending_settlement)||0)}),(0,l.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:["Next: ",(null==F?void 0:F.next_settlement_date)?new Date(F.next_settlement_date).toLocaleDateString():"N/A"]})]}),(0,l.jsxs)("div",{className:"p-4 rounded-lg bg-green-50 border border-green-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-sm text-slate-600",children:"Commission Earned"}),(0,l.jsx)(j.Z,{className:"h-4 w-4 text-green-600"})]}),(0,l.jsx)("p",{className:"text-2xl font-bold text-green-600",children:V((null==F?void 0:F.commission_earned)||0)}),(0,l.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:[(null==F?void 0:F.commission_rate)||0,"% commission rate"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Recent Settlements"}),(0,l.jsx)("div",{className:"space-y-2",children:null==F?void 0:null===(P=F.settlement_history)||void 0===P?void 0:P.slice(0,3).map((e,s)=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-50",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium",children:new Date(e.date).toLocaleDateString()}),(0,l.jsxs)("p",{className:"text-xs text-slate-600",children:[V(e.commission)," commission"]})]}),(0,l.jsx)(k.Z,{className:"h-4 w-4 text-green-600"})]},s))})]})]})]})]})]})]})})}},61264:function(e,s,t){"use strict";t.d(s,{A:function(){return r}});var l=t(57437),a=t(10273),i=t(77700);function r(e){let{title:s,value:t,icon:r,trend:n,trendValue:c,subtitle:d,className:o,gradient:x=!1}=e,m=c>0;return(0,l.jsxs)(a.Zb,{className:(0,i.cn)("transition-all duration-300 hover:shadow-xl border-0",x&&"bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 text-white",!x&&"bg-white",o),children:[(0,l.jsxs)(a.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(a.ll,{className:(0,i.cn)("text-sm font-medium",x?"text-white/90":"text-slate-600"),children:s}),r&&(0,l.jsx)("div",{className:(0,i.cn)("p-2 rounded-lg",x?"bg-white/20":"bg-blue-50"),children:(0,l.jsx)(r,{className:(0,i.cn)("h-4 w-4",x?"text-white":"text-blue-600")})})]}),(0,l.jsxs)(a.aY,{children:[(0,l.jsx)("div",{className:(0,i.cn)("text-2xl font-bold",x?"text-white":"text-slate-900"),children:t}),(d||void 0!==c)&&(0,l.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[void 0!==c&&(0,l.jsxs)("span",{className:(0,i.cn)("text-xs font-medium flex items-center",x?"text-white/80":m?"text-green-600":"text-red-600"),children:[m?"â†‘":"â†“"," ",Math.abs(c),"%"]}),d&&(0,l.jsx)("p",{className:(0,i.cn)("text-xs",x?"text-white/70":"text-slate-500"),children:d})]})]})]})}},92940:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(78030).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},40933:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(78030).Z)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},98094:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(78030).Z)("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},11240:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});let l=(0,t(78030).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}},function(e){e.O(0,[419,77,213,821,971,23,744],function(){return e(e.s=96335)}),_N_E=e.O()}]);